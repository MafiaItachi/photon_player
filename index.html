<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>PHOTON PLAYER</title>
    <link rel="icon" href="image/songicon.jpg" type="image/icon">
    <script src="https://kit.fontawesome.com/bac1e9dfb2.js" crossorigin="anonymous"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <style>
        @media screen and (max-width: 480px) {
            /* CSS styles specific to mobile devices with a screen width up to 480px */
            /* Adjust the text size or other styles here */
        }

        #player {
            width: 360px;
            height: 221px;

            overflow: hidden;
            border-radius: 20px;
        }

        body {
            background: #003994;
            /* width: 100%; */
            padding: 5px;
            font-family: "Sans Serif", Arial, sans-serif;
        }

        #repeat-mode {
            width: 60px;
            height: 30px;
            margin: 10px;

            font-size: 14px;
            padding: 5px;
            background-color: #008EC4;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        #repeat-mode option {
            background-color: #008EC4;
            color: #fff;
        }



        #controls {
            margin-top: 20px;
        }

        #seek-bar {
            height: 4px;
            width: 97%;

            background-color: #ccc;
            position: absolute;
            bottom: 2px;
            right: 4px;
            left: 6px;
            border-radius: 4px;
            cursor: pointer;
        }

        #seek-bar #progress-bar {
            width: 0%;
            height: 100%;
            background-color: #0064B5;
            border-radius: 4px;
        }



        .more-button {
            float: right;
            background: none;
            border: none;
            color: #003994;
            cursor: pointer;
            padding: 0;
            font-size: .8rem;
        }

        .more-button:focus {
            outline: none;
        }

        .more-dropdown {
            display: none;
            position: relative;
            right: 5px;
            top: 10px;
            background-color: #00B7C6;
            padding: 5px;

            text-align: right;
        }

        .more-dropdown a {
            display: block;
            padding: 5px 10px;
            text-decoration: none;
            color: #333;
            transition: background-color 0.3s ease;
        }

        .more-dropdown a:hover {
            background-color: #eee;
        }

        #shuffle button {
            border-radius: 20px;
        }

        .playlist-item {
            margin: 5px 0;
            padding: 10px;
            background-color: #00B7C6;
            border-radius: 14px;
            display: flex;
            align-items: center;
            width: 98%;
        }

        .playlist-item strong {
            font-weight: bold;
            margin-right: 5px;
            width: 30px;
            color: #190061;
        }

        .playlist-item img {
            width: 45px;
            height: 38px;
            margin-right: 10px;
            border-radius: 25%;
        }

        .playlist-item p {
            margin: 0;
            flex-grow: 1;
            color: #190061;
            font-size: 0.9rem;
        }

        .playlist-controls {
            display: flex;
            align-items: center;
        }

        .playlist-controls a {
            margin-right: 10px;
            color: #008EC4;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .playlist-controls a:hover {
            color: #0064B5;
        }

        .playlist-message {
            text-align: center;
            font-style: italic;
            color: #999;
        }

        h1,
        h2 {
            color: #ffffff;
        }

        input[type="text"],
        button {
            background-color: #008EC4;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 15px;
            cursor: pointer;
            border-radius: 18px;
        }

        input[type="text"]::placeholder {
            color: #fff;
            opacity: 0.7;

        }

        button:hover {
            background-color: #0064B5;
        }

        button:focus {
            outline: none;
        }

        #results {
            margin-top: 20px;
        }

        .result-item {
            margin-bottom: 20px;
        }

        .result-video {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            background-color: #f2f2f2;
            overflow: hidden;
            border-top-right-radius: 20px;
            border-top-left-radius: 20px;

        }

        .result-video iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .result-details {
            background-color: #0064B5;
            padding: 10px;

            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        .result-title {
            font-size: 18px;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .result-buttons {
            margin-top: 10px;
            border-radius: 20px;
        }

        .result-buttons button {
            margin-right: 10px;
            border-radius: 20px;
        }

        .backup-restore {
            margin-top: 20px;
            display: flex;
            align-items: center;
        }

        .backup-restore input[type="text"] {
            flex-grow: 1;
            margin-right: 10px;
        }

        .backup-restore button {
            background-color: #003994;
            color: #fff;
        }

        #controls {
            height: 75px;
            widgh: 100%;
            background-color: #190061;
            position: fixed;
            bottom: 5px;
            right: 5px;
            left: 5px;
            border-radius: 10px;
            padding-right: 5px;
            z-index: 1;

        }

        .video-thumbnail {
            width: 60px;
            height: 50px;
            margin-left: 9px;
            margin-top: 0px;
            background-color: white;

            border-radius: 10px;
        }

        .con {
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;

        }

        .video-title {
            width: 180px;
            color: white;
            margin-left: 10px;
            display: flex;
            align-item: center;

        }

        /* Existing styles... */

        /* Mini player styles */
        .mini-player {
            position: fixed;
            bottom: 3px;
            left: 6px;
            width: 99%;
            height: 380px;
            background-color: #190061;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
            display: flex;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
            flex-direction: column;
            border-radius: 10px;
        }

        .mini-player-controls {
            flex-grow: 1;
            display: flex;
            align-items: center;
        }

        .mini-player-details {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            color: white;
        }

        .mini-player-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mini-player-buttons {
            align-items: center;
            display: flex;
            justify-content: space-around;
        }

        .mini-player-buttons button {
            background-color: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: 5px;
            height: 50px;
            width: 50px;

        }

        .mini-player-buttons button:focus {
            outline: none;
        }

        .player-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .video-title2 {
            color: white;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .seekbar2 {
            width: 100%;
            height: 5px;
            background-color: #666;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar2 {
            width: 0;
            height: 100%;
            background-color: #fff;
        }
    </style>
</head>

<body>
    <h1>PHOTON PLAYER</h1>
    <input type="text" id="searchInput" placeholder="Enter song or artist">
    <button onclick="clearSearchResults()"><i class="fa-regular fa-circle-xmark fa-xl"></i></button>
    </div>
    <button onclick="search()"><i class="fa-solid fa-magnifying-glass fa-xl"></i></button>

    <div id="results"></div>

    <h2>PLAYLIST</h2>
    <div class="shuffle">
        <button onclick="clearPlaylist()"><i class="fa-solid fa-trash fa-xl"></i></button>
        <button onclick="stopVideo()"><i class="fa-solid fa-pause fa-xl"></i></button>
        <button onclick="shuffleAndPlay()"><i class="fa-solid fa-random fa-xl"></i></button>
    </div>

    <div id="playlist"></div>
    <br></br>
    <div id="controls">
        <div class="con">
            <img class="video-thumbnail" src="image/songicon.jpg">
            <div class="video-title"></div>
            <button id="repeat-toggle" class="repeat-option" onclick="toggleRepeatMode()"><i
                    class="fa-solid fa-repeat fa-lg"></i></button>
            <button id="play-pause"><i class="fa-solid fa-play fa-xl"></i></button>
        </div>

        <div id="seek-bar">
            <div id="progress-bar"></div>
        </div>
        <div id="mini-player" class="mini-player">
            <div id="player"></div>


            <div class="player-controls">
                <div class="seekbar2">
                    <div class="progress-bar2"></div>
                </div><br>
                <div class="video-title2"></div>
            </div>
            <div class="mini-player-buttons">
                <button class="mini-player-previous-button" onclick="playPreviousTrack()"><i
                        class="fa-solid fa-chevron-left fa-xl"></i></button>
                <button class="mini-player-play-button" onclick="togglePlayPause()"><i
                        class="fa-solid fa-play fa-xl"></i></button>
                <button class="mini-player-next-button" onclick="playNextTrack()"><i
                        class="fa-solid fa-chevron-right fa-xl"></i></button>
            </div>


        </div>



    </div>
    <h2>Add Playlist by Link</h2>
    <input type="text" id="playlistLinkInput" placeholder="Enter YouTube Playlist Link">
    <button onclick="addPlaylistByLink()">Add Playlist</button>
    <div class="backup-restore">
        <input type="text" id="backupInput" placeholder="backup code">
        <button onclick="backupPlaylist()"><i class="fa-solid fa-file-export fa-xl"></i></button>
        <button onclick="restorePlaylist()"><i class="fa-solid fa-file-import fa-xl"></i></button>


    </div>
    <br></br><br></br><br></br><br></br>

    <script>
        var currentVideoIndex = -1;
        var player;
        var isPlaying = false;
        var progressInterval;
        var repeatMode = "repeat-all";
        var repeatModes = ["no-repeat", "repeat-one", "repeat-all"];

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '360',
                width: '640',
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            // Player is ready to receive commands
            $('#play-pause').click(togglePlayPause);
            $('#seek-bar').click(seek);
            $('#volume-bar').click(setVolume);
            $('#repeat-mode').change(changeRepeatMode);
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                startProgressInterval();
            } else {
                isPlaying = false;
                stopProgressInterval();
            }

            if (event.data === YT.PlayerState.ENDED) {
                handleVideoEnd();
            }
            updateVideoTitle2();
             updateVideoTitle3();
            updatePlayPauseButton();
        }
       

        function updateProgressBar() {
            var currentTime = player.getCurrentTime();
            var duration = player.getDuration();
            var progress = (currentTime / duration) * 100;

            $('#progress-bar').css('width', progress + '%');
            $('.progress-bar2').css('width', progress + '%');
        }
        function handleVideoEnd() {
            if (repeatMode === "repeat-one") {
                player.playVideo();
            } else if (repeatMode === "repeat-all") {
                currentVideoIndex++;
                if (currentVideoIndex >= playlistItems.length) {
                    currentVideoIndex = 0;
                }
                playVideo(playlistItems[currentVideoIndex].videoId);
            } else {
                isPlaying = false;
                updatePlayPauseButton();
            }
        }
        // Function to play the next track
        function playNextTrack() {
            currentVideoIndex++;
            if (currentVideoIndex >= playlistItems.length) {
                currentVideoIndex = 0;
            }
            playVideo(playlistItems[currentVideoIndex].videoId);
        }

        // Function to play the previous track
        function playPreviousTrack() {
            currentVideoIndex--;
            if (currentVideoIndex < 0) {
                currentVideoIndex = playlistItems.length - 1;
            }
            playVideo(playlistItems[currentVideoIndex].videoId);
        }

        function togglePlayPause() {
            if (isPlaying) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        function updatePlayPauseButton() {
            var button = $('#play-pause');

            button.html(isPlaying ? '<i class="fa-solid fa-pause fa-xl"></i>' : '<i class="fa-solid fa-play fa-xl"></i>');
        }

        function startProgressInterval() {
            progressInterval = setInterval(updateProgressBar, 1000);
        }

        function stopProgressInterval() {
            clearInterval(progressInterval);
        }



        function seek(event) {
            var seekBar = $('#seek-bar');
            var offsetX = event.pageX - seekBar.offset().left;
            var barWidth = seekBar.outerWidth();
            var seekTime = (offsetX / barWidth) * player.getDuration();

            player.seekTo(seekTime, true);
        }

        function setVolume(event) {
            var volumeBar = $('#volume-bar');
            var offsetX = event.pageX - volumeBar.offset().left;
            var barWidth = volumeBar.outerWidth();
            var volumeLevel = offsetX / barWidth;

            player.setVolume(volumeLevel * 100);
            $('#volume-level').css('width', offsetX + 'px');
        }

        function toggleRepeatMode() {
            const repeatToggle = document.getElementById('repeat-toggle');
            if (repeatMode === 'no-repeat') {
                repeatMode = 'repeat-all';
                repeatToggle.innerHTML = '<i class="fa-solid fa-repeat fa-lg"></i>';
            } else if (repeatMode === 'repeat-all') {
                repeatMode = 'repeat-one';
                repeatToggle.innerHTML = '<i class="fa-solid fa-redo fa-lg"></i>';
            } else {
                repeatMode = 'no-repeat';
                repeatToggle.innerHTML = '<i class="fa-solid fa-times-circle fa-lg"></i>';
            }
        }

        function setInitialRepeatModeIcon() {
            const repeatToggle = document.getElementById('repeat-toggle');
            if (repeatMode === 'no-repeat') {
                repeatToggle.innerHTML = '<i class="fa-solid fa-times-circle fa-lg"></i>';
            } else if (repeatMode === 'repeat-all') {
                repeatToggle.innerHTML = '<i class="fa-solid fa-repeat fa-lg"></i>';
            } else {
                repeatToggle.innerHTML = '<i class="fa-solid fa-redo fa-lg"></i>';
            }
        }

        var apiKeys = ['AIzaSyB8I395JE6CdPKh2mULCPIss6i3rz5m7UY', 'AIzaSyCm3Ezp_uPaNeMjOTXMYVM0FmQ015auYeA',]; // Array of API keys
        var currentApiKeyIndex = 0; // Index of the current API key being used

        function search() {
            var query = document.getElementById("searchInput").value;
            var apiKey = apiKeys[currentApiKeyIndex];

            var url = "https://www.googleapis.com/youtube/v3/search?part=snippet&q=" + query + "&type=video&key=" + apiKey;

            $.ajax({
                url: url,
                success: function (response) {
                    displayResults(response);
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        }




        function addToPlaylist(videoId, videoTitle) {
            var playlist = localStorage.getItem("playlist");
            playlistItems = playlist ? JSON.parse(playlist) : [];

            playlistItems.push({
                videoId: videoId,
                videoTitle: videoTitle
            });

            localStorage.setItem("playlist", JSON.stringify(playlistItems));

            displayPlaylist();
        }


        function playVideo(videoId, videoTitle, thumbnailUrl) {
            if (player) {
                currentVideoIndex = playlistItems.findIndex(item => item.videoId === videoId);
                player.loadVideoById(videoId);
                player.playVideo();

                // Display video title and thumbnail
                var videoTitleElement = document.querySelector(".video-title");
                var videoThumbnailElement = document.querySelector(".video-thumbnail");

                // Set video title with word limit of 5
                var truncatedTitle = videoTitle.split(' ').splice(0, 5).join(' ');
                videoTitleElement.textContent = truncatedTitle;
                videoThumbnailElement.src = thumbnailUrl;
            }
        }


        function playVideos(videoId) {
    if (player) {
        currentVideoIndex = playlistItems.findIndex(item => item.videoId === videoId);
        player.loadVideoById(videoId);
        player.playVideo();

        // Display video title and thumbnail
        var currentVideo = playlistItems.find(function (item) {
            return item.videoId === videoId;
        });

        if (currentVideo) {
            var videoTitleElement = document.querySelector(".video-title");
            var videoThumbnailElement = document.querySelector(".video-thumbnail");

            var videoTitle = currentVideo.videoTitle;
            var truncatedTitle = videoTitle.split(' ').splice(0, 5).join(' ');

            videoTitleElement.textContent = truncatedTitle;
            videoThumbnailElement.src = "https://img.youtube.com/vi/" + videoId + "/default.jpg";

            // Call the updateVideoTitle2 function here
            updateVideoTitle2();
            updateVideoTitle3();
        }
    }
}

function updateVideoTitle2() {
    if (player && playlistItems[currentVideoIndex]) {
        var videoTitle = playlistItems[currentVideoIndex].videoTitle;
        var videoTitleElement = document.querySelector('.video-title');
        var truncatedTitle = videoTitle.split(' ').splice(0, 5).join(' ');

            videoTitleElement.textContent = truncatedTitle;
        var videoThumbnailElement = document.querySelector('.video-thumbnail');
        videoThumbnailElement.src = 'https://img.youtube.com/vi/' + playlistItems[currentVideoIndex].videoId + '/default.jpg';
    }
}





function updateVideoTitle3() {
    if (player && playlistItems[currentVideoIndex]) {
        var videoTitle = playlistItems[currentVideoIndex].videoTitle;
        var videoTitleElement = document.querySelector('.video-title2');
        var truncatedTitle = videoTitle.split(' ').splice(0, 5).join(' ');

            videoTitleElement.textContent = truncatedTitle;

        var videoThumbnailElement = document.querySelector('.video-thumbnail');
        videoThumbnailElement.src = 'https://img.youtube.com/vi/' + playlistItems[currentVideoIndex].videoId + '/default.jpg';
    }
}


        function displayResults(response) {
            var results = document.getElementById("results");
            results.innerHTML = "";

            for (var i = 0; i < response.items.length; i++) {
                var video = response.items[i];
                var videoId = video.id.videoId;
                var videoTitle = video.snippet.title;
                var thumbnailUrl = video.snippet.thumbnails.default.url;

                var div = document.createElement("div");
                div.className = "result-item";

                var videoDiv = document.createElement("div");
                videoDiv.className = "result-video";
                videoDiv.innerHTML = '<iframe src="https://www.youtube.com/embed/' + videoId + '" width="560" height="315" frameborder="0" allowfullscreen></iframe>';

                var detailsDiv = document.createElement("div");
                detailsDiv.className = "result-details";

                var title = document.createElement("p");
                title.className = "result-title";
                title.textContent = videoTitle;

                var buttonsDiv = document.createElement("div");
                buttonsDiv.className = "result-buttons";

                var addToPlaylistButton = document.createElement("button");
                addToPlaylistButton.textContent = "Add to Playlist";
                addToPlaylistButton.addEventListener("click", function (id, title, thumbnail) {
                    return function () {
                        addToPlaylist(id, title, thumbnail);
                    };
                }(videoId, videoTitle, thumbnailUrl));

                var playVideoButton = document.createElement("button");
                playVideoButton.textContent = "Play Video";
                playVideoButton.addEventListener("click", function (id, title, thumbnail) {
                    return function () {
                        playVideo(id, title, thumbnail);
                    };
                }(videoId, videoTitle, thumbnailUrl));

                buttonsDiv.appendChild(addToPlaylistButton);
                buttonsDiv.appendChild(playVideoButton);

                detailsDiv.appendChild(title);
                detailsDiv.appendChild(buttonsDiv);

                div.appendChild(videoDiv);
                div.appendChild(detailsDiv);

                results.appendChild(div);
            }
            currentApiKeyIndex = (currentApiKeyIndex + 1) % apiKeys.length;
        }









        function displayPlaylist() {
            var playlistDiv = document.getElementById("playlist");
            playlistDiv.innerHTML = "";

            var storedPlaylist = localStorage.getItem("playlist");
            if (storedPlaylist) {
                playlistItems = JSON.parse(storedPlaylist);
                for (var i = 0; i < playlistItems.length; i++) {
                    var playlistItem = document.createElement("div");
                    playlistItem.className = "playlist-item";
                    var thumbnail = document.createElement("img");
                    thumbnail.src = "https://img.youtube.com/vi/" + playlistItems[i].videoId + "/default.jpg";
                    playlistItem.setAttribute("onclick", "playVideos('" + playlistItems[i].videoId + "')");

                    var listItem = document.createElement("p");
                    var moreButton = document.createElement("button");
                    var moreDropdown = document.createElement("div");
                    var playlistControls = document.createElement("div");
                    var playOption = document.createElement("a");
                    var removeOption = document.createElement("a");

                    var videoTitle = playlistItems[i].videoTitle;
                    var truncatedTitle = videoTitle.split(' ').splice(0, 6).join(' ');

                    listItem.innerHTML = "<strong>" + (i + 1) + ". </strong>" + truncatedTitle;


                    moreButton.innerHTML = '<i class="fa-solid fa-ellipsis-vertical fa-sm"></i>';
                    moreButton.className = "more-button";
                    moreButton.addEventListener("click", function (index) {
                        return function () {
                            toggleDropdown(index);
                        };
                    }(i));

                    moreDropdown.className = "more-dropdown";

                    playOption.textContent = "Play";
                    playOption.href = "#";
                    playOption.addEventListener("click", function (index) {
                        return function () {
                            currentVideoIndex = index;
                            playVideo(playlistItems[currentVideoIndex].videoId);
                            toggleDropdown(index);
                        };
                    }(i));

                    removeOption.textContent = "Remove";
                    removeOption.href = "#";
                    removeOption.addEventListener("click", function (index) {
                        return function () {
                            removeFromPlaylist(index);
                            toggleDropdown(index);
                        };
                    }(i));

                    moreDropdown.appendChild(playOption);
                    moreDropdown.appendChild(removeOption);

                    listItem.appendChild(moreButton);
                    listItem.appendChild(moreDropdown);
                    playlistItem.appendChild(thumbnail);
                    playlistItem.appendChild(listItem);
                    playlistDiv.appendChild(playlistItem);
                }
            } else {
                playlistDiv.innerHTML = "Playlist is empty";
            }
        }



        function clearPlaylist() {
            localStorage.removeItem("playlist");
            playlistItems = [];
            displayPlaylist();
            currentVideoIndex = 0;
            if (player) {
                player.stopVideo();
            }
        }
        function stopVideo() {
            if (player) {
                player.stopVideo();
            }
        }

        function removeFromPlaylist(index) {
            if (index >= 0 && index < playlistItems.length) {
                playlistItems.splice(index, 1);
                localStorage.setItem("playlist", JSON.stringify(playlistItems));
                displayPlaylist();
            }
        }
        function backupPlaylist() {
            var backupCode = btoa(JSON.stringify(playlistItems));
            document.getElementById("backupInput").value = backupCode;
        }

        function restorePlaylist() {
            var backupCode = document.getElementById("backupInput").value;
            var restoredPlaylist = atob(backupCode);
            playlistItems = JSON.parse(restoredPlaylist);
            localStorage.setItem("playlist", JSON.stringify(playlistItems));
            displayPlaylist();
        }


        function toggleDropdown(index) {
            var dropdowns = document.getElementsByClassName("more-dropdown");
            for (var i = 0; i < dropdowns.length; i++) {
                if (i === index) {
                    dropdowns[i].style.display = dropdowns[i].style.display === "none" ? "block" : "none";
                } else {
                    dropdowns[i].style.display = "none";
                }
            }
        }
        function clearSearchResults() {
            var results = document.getElementById("results");
            results.innerHTML = "";
            document.getElementById("searchInput").value = "";
        }

        // Initialize Hammer.js on the controls section
        var controlsElement = document.getElementById('controls');
        var controlsHammer = new Hammer(controlsElement);

        // Detect swipe gestures
        controlsHammer.on('swipeleft', function () {
            playNextTrack();
        });

        controlsHammer.on('swiperight', function () {
            playPreviousTrack();
        });

        // Function to play the next track
        function playNextTrack() {
            currentVideoIndex++;
            if (currentVideoIndex >= playlistItems.length) {
                currentVideoIndex = 0;
            }
            playVideos(playlistItems[currentVideoIndex].videoId);
        }

        // Function to play the previous track
        function playPreviousTrack() {
            currentVideoIndex--;
            if (currentVideoIndex < 0) {
                currentVideoIndex = playlistItems.length - 1;
            }
            playVideos(playlistItems[currentVideoIndex].videoId);
        }

        // Initialize Hammer.js on the controls section
        var controlsElement = document.getElementById('controls');
        var controlsHammer = new Hammer(controlsElement);

        // Detect swipe up and swipe down gestures
        controlsHammer.get('swipe').set({ direction: Hammer.DIRECTION_VERTICAL });
        controlsHammer.on('swipeup swipedown', function (event) {
            event.preventDefault();
        });

        controlsHammer.on('swipeup', function () {
            showMiniPlayer();
        });

        controlsHammer.on('swipedown', function () {
            hideMiniPlayer();
        });

        // Function to show the mini player
        // Function to show the mini player
        function showMiniPlayer() {
            var miniPlayer = document.getElementById('mini-player');
            miniPlayer.style.transform = 'translateY(0)';
        }


        // Function to hide the mini player
        function hideMiniPlayer() {
            var miniPlayer = document.getElementById('mini-player');
            miniPlayer.style.transform = 'translateY(100%)';
        }


        function shuffleAndPlay() {
            var storedPlaylist = localStorage.getItem("playlist");
            if (!storedPlaylist) {
                alert("Playlist is empty. Add videos to the playlist first.");
                return;
            }

            playlistItems = JSON.parse(storedPlaylist);
            shuffleArray(playlistItems);
            currentVideoIndex = 0;


            if (player) {
                playVideos(playlistItems[currentVideoIndex].videoId);
            }
        }

        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
        }
        function addPlaylistByLink() {
            var playlistLink = document.getElementById("playlistLinkInput").value;
            var playlistId = extractPlaylistId(playlistLink);

            if (playlistId) {
                fetchPlaylistItems(playlistId);
            } else {
                alert("Invalid YouTube playlist link. Please enter a valid link.");
            }
        }

        function extractPlaylistId(playlistLink) {
            var regex = /[&?](?:list|p)=([a-zA-Z0-9_-]{34})/;
            var match = playlistLink.match(regex);

            if (match && match.length > 1) {
                return match[1];
            }

            return null;
        }

        function fetchPlaylistItems(playlistId) {
            var apiKey = apiKeys[currentApiKeyIndex];
            var url =
                "https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=" +
                playlistId +
                "&key=" +
                apiKey;

            $.ajax({
                url: url,
                success: function (response) {
                    processPlaylistItems(response.items);
                },
                error: function (xhr) {
                    console.log(xhr);
                },
            });
        }

        function processPlaylistItems(items) {
            var playlist = localStorage.getItem("playlist");
            playlistItems = playlist ? JSON.parse(playlist) : [];

            for (var i = 0; i < items.length; i++) {
                var video = items[i].snippet;
                var videoId = video.resourceId.videoId;
                var videoTitle = video.title;

                playlistItems.push({
                    videoId: videoId,
                    videoTitle: videoTitle,
                });
            }

            localStorage.setItem("playlist", JSON.stringify(playlistItems));

            displayPlaylist();
        }

        displayPlaylist();
    </script>

    <script>
        // Load the YouTube IFrame Player API asynchronously
        // Load the YouTube IFrame Player API asynchronously
        var tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>
</body>

</html>
