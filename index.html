<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>PHOTON PLAYER</title>
    <script src="https://kit.fontawesome.com/bac1e9dfb2.js" crossorigin="anonymous"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <style>
        @media screen and (max-width: 480px) {
    /* CSS styles specific to mobile devices with a screen width up to 480px */
    /* Adjust the text size or other styles here */
        }
        #player {
            width:370px;
            margin: 10px;
            overflow: hidden;
            border-radius: 10px;
        }

        body {
            align-items: center;
            margin: 10px;
            background: #003994;
            /* width: 100%; */
            padding: 5px;
            font-family: "Sans Serif", Arial, sans-serif;
        }

        #repeat-mode {
            width: 60px;
            height: 30px;
            margin: 10px;

            font-size: 14px;
            padding: 5px;
            background-color: #008EC4;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        #repeat-mode option {
            background-color: #008EC4;
            color: #fff;
        }



        #controls {
            margin-top: 20px;
        }

        #seek-bar {
            height: 4px;
            width: 97%;

            background-color: #ccc;
            position: absolute;
            bottom: 2px;
            right: 4px;
            left: 6px;
            border-radius: 4px;
            cursor: pointer;
        }

        #seek-bar #progress-bar {
            width: 0%;
            height: 100%;
            background-color: #0064B5;
            border-radius: 4px;
        }



        .more-button {
            float: right;
            background: none;
            border: none;
            color: #003994;
            cursor: pointer;
            padding: 0;
            font-size: .8rem;
        }

        .more-button:focus {
            outline: none;
        }

        .more-dropdown {
            display: none;
            position: relative;
            right: 5px;
            top: 10px;
            background-color: #00B7C6;
            padding: 5px;

            text-align: right;
        }

        .more-dropdown a {
            display: block;
            padding: 5px 10px;
            text-decoration: none;
            color: #333;
            transition: background-color 0.3s ease;
        }

        .more-dropdown a:hover {
            background-color: #eee;
        }

        #shuffle button {
            border-radius: 20px;
        }

        .playlist-item {
            margin: 5px 0;
            padding: 10px;
            background-color: #00B7C6;
            border-radius: 14px;
            display: flex;
            align-items: center;
            
        }

        .playlist-item strong {
            font-weight: bold;
            margin-right: 5px;
            width: 30px;
            color: #190061;
        }

        .playlist-item img {
            width: 45px;
            height: 38px;
            margin-right: 10px;
            border-radius: 25%;
        }

        .playlist-item p {
            margin: 0;
            flex-grow: 1;
            color: #190061;
            font-size: 0.9rem;
        }

        .playlist-controls {
            display: flex;
            align-items: center;
        }

        .playlist-controls a {
            margin-right: 10px;
            color: #008EC4;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .playlist-controls a:hover {
            color: #0064B5;
        }

        .playlist-message {
            text-align: center;
            font-style: italic;
            color: #999;
        }

        h1,
        h2 {
            color: #ffffff;
        }

     input[type="text"]{

            background-color: #008EC4;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 15px;
            cursor: pointer;
            border-radius: 18px;
            height: 25px;
         margin:5px ;
        }
        button {
            background-color: #008EC4;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 15px;
            cursor: pointer;
            border-radius: 18px;
            height: 40px;
            margin:5px ;
        }

        input[type="text"]::placeholder {
            color: #fff;
            opacity: 0.7;

        }

        button:hover {
            background-color: #0064B5;
        }

        button:focus {
            outline: none;
        }

        #results {
            margin-top: 20px;
        }

        .result-item {
            margin-bottom: 20px;
        }

        .result-video {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            background-color: #f2f2f2;
            overflow: hidden;
            border-top-right-radius: 20px;
            border-top-left-radius: 20px;

        }

        .result-video iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .result-details {
            background-color: #0064B5;
            padding: 10px;

            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        .result-title {
            font-size: 18px;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .result-buttons {
            margin-top: 10px;
            border-radius: 20px;
        }

        .result-buttons button {
            margin-right: 10px;
            border-radius: 20px;
        }

        .backup-restore {
            margin-top: 20px;
            display: flex;
            align-items: center;
        }

        .backup-restore input[type="text"] {
            flex-grow: 1;
            margin-right: 10px;
        }

        .backup-restore button {
            background-color: #003994;
            color: #fff;
        }

        #controls {
            height: 75px;
            widgh: 100%;
            background-color: #190061;
            position: fixed;
            bottom: 5px;
            right: 5px;
            left: 5px;
            border-radius: 10px;
            padding-right: 5px;
            z-index: 1;

        }

        .video-thumbnail {
            width: 60px;
            height: 50px;
            margin-left: 9px;
            margin-top: 0px;
            background-color: white;

            border-radius: 10px;
        }

        .con {
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;

        }

        .video-title {
            width: 180px;
            color: white;
            margin-left: 10px;
            display: flex;
            align-item: center;

        }

        /* Existing styles... */

        /* Mini player styles */
        .mini-player {
            position: fixed;
            bottom: 10px;
            left: 5px;
            right: 5px;
            margin-bottom: -5px;
            /* height: 380px; */
            background-color: #190061;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
            display: flex;
            align-items: center;
            padding: 0px;
            
            box-sizing: border-box;
            flex-direction: column;
            border-radius: 10px;
        }

        .mini-player-controls {
            flex-grow: 1;
            display: flex;
            align-items: center;
        }

        .mini-player-details {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            color: white;
        }

        .mini-player-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mini-player-buttons {
            align-items: center;
            width: 75vw;
            display: flex;
            justify-content: space-around;
             margin: 20px;
        }

        .mini-player-buttons button {
            
            cursor: pointer;
            padding: 5px;
            height: 50px;
            width: 50px;

        }

        .mini-player-buttons button:focus {
            outline: none;
        }

        .player-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .video-title2 {
            color: white;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .seekbar2 {
            width: 75vw;
            height: 5px;
            background-color: #666;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar2 {
            width: 0;
            height: 100%;
            background-color: #fff;
        }
h1 {
            text-align: center;
        }

        .playlist-container {
            margin: 20px 0;
            overflow-x: auto;
            white-space: nowrap;
        }

        .playlist {
            display: inline-block;
           
            margin-right: 7px;
            vertical-align: top;
            background-color: #00B7C6;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .playlist h2 {
            padding: 10px;
            margin: 0;
            font-size: 16px;
            background-color: #003994;
            color: #fff;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .playlist-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .song-list-container {
            display: none;
            padding: 10px;
        }

        .song-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .song-list li {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .song-list li:hover {
            background-color: #00B7C6;
        }

        .song-thumbnail {
            width: 60px;
            height: 40px;
            margin-right: 10px;
        }

        .song-title {
            flex-grow: 1;
        }


        .playlist-container {
    margin: 20px 0;
    padding: 7px;
    background-color: #00B7C6;
    /* border: 1px solid #ddd; */
    border-radius: 5px;
    
   
}

.playlist-container h2 {
    font-size: 20px;
    margin: 0;
    padding: 10px;
    background-color: #003994;
    color: #fff;
    border-bottom-right-radius: 5px;
    border-top-right-radius: 5px;

     border-top-left-radius: 0px;
}

.playlist-thumbnail {
    width: 60%;
    height: auto;
    max-height: 180px;
    object-fit: cover;
    border-top-left-radius: 5px;
    border-bottom-left-radius: 5px;
    border-top-right-radius: 0px;
    
}

.song-list-container {
    padding: 0px;
    display: none;
}

.song-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.song-list li {
    display: flex;
    align-items: center;
    padding: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    border-bottom: 1px solid #ddd;
}



.song-thumbnail {
    width: 60px;
    height: 40px;
    margin-right: 10px;
}

.song-title {
    flex-grow: 1;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
}

.playlist-container button {
    margin-top: 5px;
    height: 100%;
    background-color: #003994;
    color: #fff;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 0px 5px 5px 0px;
    font-size: 16px;
}

.playlist-container button:hover {
    background-color: #002277;
}

.playlist-container button:focus {
    outline: none;
}

        .song-list-container .song-title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 15em; /* Adjust the width as needed */
}
.nothing{
    display: flex;
    justify-content: space-around;
    

}

.nothing2{
    width: 100%;
    display: flex;
    flex-direction:column;

}
        .sxq{
    width: 100%;
    display: flex;
}
    </style>
</head>
<body>
 

   <h1>PHOTON PLAYER</h1>
    <div class="sxq"><input type="text" id="searchInput" placeholder="Enter song or artist">
      <button onclick="clearSearchResults()"><i class="fa-regular fa-circle-xmark fa-xl"></i></button>
    
    <button onclick="search()"><i class="fa-solid fa-magnifying-glass fa-xl"></i></button>
</div>
    <div id="results"></div>

    <h2>PLAYLIST</h2>
     <div class="shuffle">
     <button onclick="clearPlaylist()"><i class="fa-solid fa-trash fa-xl"></i></button>
     <button onclick="stopVideo()"><i class="fa-solid fa-pause fa-xl"></i></button>
    <button onclick="shuffleAndPlay()"><i class="fa-solid fa-random fa-xl"></i></button>
      </div>
 
    <div id="playlist"></div>
    <br></br>
     <div id="controls">
        <div class="con">
          <img class="video-thumbnail" src="" >
          <div class="video-title"></div>
          <button id="repeat-toggle" class="repeat-option" onclick="toggleRepeatMode()"><i class="fa-solid fa-repeat fa-lg"></i></button>
         <button id="play-pause"><i class="fa-solid fa-play fa-xl"></i></button>
         </div>
    
         <div id="seek-bar">
             <div id="progress-bar"></div>
         </div>
   <div id="mini-player" class="mini-player">
      <div id="player"></div>
      
        
           <div class="player-controls">
                <div class="seekbar2">
                  <div class="progress-bar2"></div>
                </div><br>
                <div class="video-title2"></div>
           </div>
       <button id="addToPlaylistButton" onclick="addToPlaylistFromVideo()"><i class="fa-solid fa-plus fa-xl"></i></button>

                  <div class="mini-player-buttons">
                       <button class="mini-player-previous-button" onclick="playPreviousTrack()"><i class="fa-solid fa-chevron-left fa-xl"></i></button>
                       <button class="mini-player-play-button" onclick="togglePlayPause()"><i class="fa-solid fa-play fa-xl"></i></button>
                       <button class="mini-player-next-button" onclick="playNextTrack()"><i class="fa-solid fa-chevron-right fa-xl"></i></button>
                  </div>
              
           
        </div>

 

    </div>

      <h1>Discovery</h1>
    <div class="playlist-container">
        <div class="playlist" id="playlist-rock">
            
            <div class="nothing"><img class="playlist-thumbnail" src="" alt="Playlist Thumbnail">
                <div class="nothing2"><div> <h2>Rock</h2></div>
                <button onclick="shuffleAndPlay2('rock')"><i class="fa-solid fa-random fa-xl"></i></button></div></div>
            <div class="song-list-container">
                

                <ul class="song-list"></ul>
            </div>
        </div>

        <div class="playlist" id="playlist-pop">
            <div class="nothing"><img class="playlist-thumbnail" src="" alt="Playlist Thumbnail">
                <div class="nothing2"><div> <h2>Rock</h2></div>
                <button onclick="shuffleAndPlay2('pop')"><i class="fa-solid fa-random fa-xl"></i></button></div></div>
            <div class="song-list-container">
                
                <ul class="song-list"></ul>
            </div>
        </div>

        <div class="playlist" id="playlist-electronic">
            <div class="nothing"><img class="playlist-thumbnail" src="" alt="Playlist Thumbnail">
                <div class="nothing2"><div> <h2>Rock</h2></div>
                <button onclick="shuffleAndPlay2('electronic')"><i class="fa-solid fa-random fa-xl"></i></button></div></div>
            <div class="song-list-container">
                
                <ul class="song-list"></ul>
            </div>
        </div>

        <div class="playlist" id="playlist-hiphop">
            <div class="nothing"><img class="playlist-thumbnail" src="" alt="Playlist Thumbnail">
                <div class="nothing2"><div> <h2>Rock</h2></div>
                <button onclick="shuffleAndPlay2('hiphop')"><i class="fa-solid fa-random fa-xl"></i></button></div></div>
            <div class="song-list-container">
                
                <ul class="song-list"></ul>
            </div>
        </div>
    </div>
   
    <h2>Add Playlist by Link</h2>
    <input type="text" id="playlistLinkInput" placeholder="Enter YouTube Playlist Link">
    <button onclick="addPlaylistByLink()">Add Playlist</button>
    <div class="backup-restore">
        <input type="text" id="backupInput" placeholder="backup code">
        <button onclick="backupPlaylist()"><i class="fa-solid fa-file-export fa-xl"></i></button>
        <button onclick="restorePlaylist()"><i class="fa-solid fa-file-import fa-xl"></i></button>


    </div>
    <br></br><br></br><br></br><br></br>


    <script>
        var currentVideoIndex = -1;
        var player;
        var isPlaying = false;
        var progressInterval;
        var repeatMode = "repeat-all";
        var repeatModes = ["no-repeat", "repeat-one", "repeat-all"];

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '360',
                width: '640',
                videoId: '', // Set the initial video ID here
                playerVars: {
                    'autoplay': 0,
                    'controls': 1,
                    'enablejsapi': 1,
                    'playsinline': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            // Player is ready to receive commands
            $('#play-pause').click(togglePlayPause);
            $('#seek-bar').click(seek);
            $('#volume-bar').click(setVolume);
            $('#repeat-mode').change(changeRepeatMode);
        }

   
function updateProgressBar() {
  var currentTime = player.getCurrentTime();
  var duration = player.getDuration();
  var progress = (currentTime / duration) * 100;

  $('#progress-bar').css('width', progress + '%');
  $('.progress-bar2').css('width', progress + '%');
}
function handleVideoEnd() {
    if (repeatMode === "repeat-one") {
        player.playVideo();
    } else if (repeatMode === "repeat-all") {
        currentVideoIndex++;
        if (currentVideoIndex >= playlistItems.length) {
            currentVideoIndex = 0;
        }
        playVideo(playlistItems[currentVideoIndex].videoId);
    } else {
        isPlaying = false;
        updatePlayPauseButton();
    }
}
// Function to play the next track
function playNextTrack() {
  currentVideoIndex++;
  if (currentVideoIndex >= playlistItems.length) {
    currentVideoIndex = 0;
  }
  playVideo(playlistItems[currentVideoIndex].videoId);
}

// Function to play the previous track
function playPreviousTrack() {
  currentVideoIndex--;
  if (currentVideoIndex < 0) {
    currentVideoIndex = playlistItems.length - 1;
  }
  playVideo(playlistItems[currentVideoIndex].videoId);
}

        function togglePlayPause() {
            if (isPlaying) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        function updatePlayPauseButton() {
            var button = $('#play-pause');
          
            button.html(isPlaying ? '<i class="fa-solid fa-pause fa-xl"></i>' : '<i class="fa-solid fa-play fa-xl"></i>');
        }

        function startProgressInterval() {
            progressInterval = setInterval(updateProgressBar, 1000);
        }

        function stopProgressInterval() {
            clearInterval(progressInterval);
        }

    function addToPlaylistFromVideo() {
    // Get the currently playing video's videoId
    var videoId = player.getVideoData().video_id;

    // Get the video title
    var videoTitle = player.getVideoData().title;

    // Get the existing playlist from local storage
    var storedPlaylist = localStorage.getItem("playlist");
    var playlistItems = storedPlaylist ? JSON.parse(storedPlaylist) : [];

    // Add the new video to the playlist
    playlistItems.push({
        videoId: videoId,
        videoTitle: videoTitle
    });

    // Update the playlist in local storage
    localStorage.setItem("playlist", JSON.stringify(playlistItems));

    // Display the updated playlist
    displayPlaylist();
}


        function seek(event) {
            var seekBar = $('#seek-bar');
            var offsetX = event.pageX - seekBar.offset().left;
            var barWidth = seekBar.outerWidth();
            var seekTime = (offsetX / barWidth) * player.getDuration();

            player.seekTo(seekTime, true);
        }

        function setVolume(event) {
            var volumeBar = $('#volume-bar');
            var offsetX = event.pageX - volumeBar.offset().left;
            var barWidth = volumeBar.outerWidth();
            var volumeLevel = offsetX / barWidth;

            player.setVolume(volumeLevel * 100);
            $('#volume-level').css('width', offsetX + 'px');
        }

        function toggleRepeatMode() {
    const repeatToggle = document.getElementById('repeat-toggle');
    if (repeatMode === 'no-repeat') {
        repeatMode = 'repeat-all';
        repeatToggle.innerHTML = '<i class="fa-solid fa-repeat fa-lg"></i>';
    } else if (repeatMode === 'repeat-all') {
        repeatMode = 'repeat-one';
        repeatToggle.innerHTML = '<i class="fa-solid fa-redo fa-lg"></i>';
    } else {
        repeatMode = 'no-repeat';
        repeatToggle.innerHTML = '<i class="fa-solid fa-times-circle fa-lg"></i>';
    }
}

function setInitialRepeatModeIcon() {
    const repeatToggle = document.getElementById('repeat-toggle');
    if (repeatMode === 'no-repeat') {
        repeatToggle.innerHTML = '<i class="fa-solid fa-times-circle fa-lg"></i>';
    } else if (repeatMode === 'repeat-all') {
        repeatToggle.innerHTML = '<i class="fa-solid fa-repeat fa-lg"></i>';
    } else {
        repeatToggle.innerHTML = '<i class="fa-solid fa-redo fa-lg"></i>';
    }
}

        var apiKeys = ['AIzaSyB8I395JE6CdPKh2mULCPIss6i3rz5m7UY', 'AIzaSyCm3Ezp_uPaNeMjOTXMYVM0FmQ015auYeA',]; // Array of API keys
        var currentApiKeyIndex = 0; // Index of the current API key being used

      function search() {
        var query = document.getElementById("searchInput").value;
       var apiKey = apiKeys[currentApiKeyIndex];

    var url = "https://www.googleapis.com/youtube/v3/search?part=snippet&q=" + query + "&type=video&key=" + apiKey;

    $.ajax({
        url: url,
        success: function (response) {
            displayResults(response);
        },
        error: function (xhr) {
            console.log(xhr);
        }
    });
}

 


          function addToPlaylist(videoId, videoTitle) {
            var playlist = localStorage.getItem("playlist");
            playlistItems = playlist ? JSON.parse(playlist) : [];

            playlistItems.push({
                videoId: videoId,
                videoTitle: videoTitle
            });

            localStorage.setItem("playlist", JSON.stringify(playlistItems));

            displayPlaylist();
        }

      
   






   function displayResults(response) {
    var results = document.getElementById("results");
    results.innerHTML = "";

    for (var i = 0; i < response.items.length; i++) {
        var video = response.items[i];
        var videoId = video.id.videoId;
        var videoTitle = video.snippet.title;
        var thumbnailUrl = video.snippet.thumbnails.default.url;

        var div = document.createElement("div");
        div.className = "result-item";

        var videoDiv = document.createElement("div");
        videoDiv.className = "result-video";
        videoDiv.innerHTML = '<iframe src="https://www.youtube.com/embed/' + videoId + '" width="560" height="315" frameborder="0" allowfullscreen></iframe>';

        var detailsDiv = document.createElement("div");
        detailsDiv.className = "result-details";

        var title = document.createElement("p");
        title.className = "result-title";
        title.textContent = videoTitle;

        var buttonsDiv = document.createElement("div");
        buttonsDiv.className = "result-buttons";

        var addToPlaylistButton = document.createElement("button");
        addToPlaylistButton.textContent = "Add to Playlist";
        addToPlaylistButton.addEventListener("click", function(id, title, thumbnail) {
            return function() {
                addToPlaylist(id, title, thumbnail);
            };
        }(videoId, videoTitle, thumbnailUrl));

        var playVideoButton = document.createElement("button");
        playVideoButton.textContent = "Play Video";
        playVideoButton.addEventListener("click", function(id, title, thumbnail) {
            return function() {
                playVideo(id, title, thumbnail);
            };
        }(videoId, videoTitle, thumbnailUrl));

        buttonsDiv.appendChild(addToPlaylistButton);
        buttonsDiv.appendChild(playVideoButton);

        detailsDiv.appendChild(title);
        detailsDiv.appendChild(buttonsDiv);

        div.appendChild(videoDiv);
        div.appendChild(detailsDiv);

        results.appendChild(div);
    }
    currentApiKeyIndex = (currentApiKeyIndex + 1) % apiKeys.length;
}


     

         function playVideos(videoId) {
    if (player) {
        currentVideoIndex = playlistItems.findIndex(item => item.videoId === videoId);
        player.loadVideoById(videoId);
        player.playVideo();

        // Display video title and thumbnail
        var currentVideo = playlistItems.find(function(item) {
            return item.videoId === videoId;
        });

        if (currentVideo) {
            var videoTitleElement = document.querySelector(".video-title");
            var videoThumbnailElement = document.querySelector(".video-thumbnail");

            var videoTitle = currentVideo.videoTitle;
            var truncatedTitle = videoTitle.split(' ').splice(0, 5).join(' ');

            videoTitleElement.textContent = truncatedTitle;
            videoThumbnailElement.src = "https://img.youtube.com/vi/" + videoId + "/default.jpg";
        }
    }
}



       


     function displayPlaylist() {
    var playlistDiv = document.getElementById("playlist");
    playlistDiv.innerHTML = "";

    var storedPlaylist = localStorage.getItem("playlist");
    if (storedPlaylist) {
        playlistItems = JSON.parse(storedPlaylist);
        for (var i = 0; i < playlistItems.length; i++) {
            var playlistItem = document.createElement("div");
            playlistItem.className = "playlist-item";
            var thumbnail = document.createElement("img");
                thumbnail.src = "https://img.youtube.com/vi/" + playlistItems[i].videoId + "/default.jpg";
           playlistItem.setAttribute("onclick", "playVideos('" + playlistItems[i].videoId + "')");

            var listItem = document.createElement("p");
            var moreButton = document.createElement("button");
            var moreDropdown = document.createElement("div");
            var playlistControls = document.createElement("div");
            var playOption = document.createElement("a");
            var removeOption = document.createElement("a");

            var videoTitle = playlistItems[i].videoTitle;
            var truncatedTitle = videoTitle.split(' ').splice(0, 6).join(' ');

            listItem.innerHTML = "<strong>" + (i + 1) + ". </strong>" + truncatedTitle;

           
            moreButton.innerHTML = '<i class="fa-solid fa-ellipsis-vertical fa-sm"></i>';
            moreButton.className = "more-button";
            moreButton.addEventListener("click", function(index) {
                return function() {
                    toggleDropdown(index);
                };
            }(i));

            moreDropdown.className = "more-dropdown";

            playOption.textContent = "Play";
            playOption.href = "#";
            playOption.addEventListener("click", function(index) {
                return function() {
                    currentVideoIndex = index;
                    playVideo(playlistItems[currentVideoIndex].videoId);
                    toggleDropdown(index);
                };
            }(i));

            removeOption.textContent = "Remove";
            removeOption.href = "#";
            removeOption.addEventListener("click", function(index) {
                return function() {
                    removeFromPlaylist(index);
                    toggleDropdown(index);
                };
            }(i));

            moreDropdown.appendChild(playOption);
            moreDropdown.appendChild(removeOption);

            listItem.appendChild(moreButton);
            listItem.appendChild(moreDropdown);
            playlistItem.appendChild(thumbnail);
            playlistItem.appendChild(listItem);
            playlistDiv.appendChild(playlistItem);
        }
    } else {
        playlistDiv.innerHTML = "Playlist is empty";
    }
}



        function clearPlaylist() {
            localStorage.removeItem("playlist");
            playlistItems = [];
            displayPlaylist();
            currentVideoIndex = 0;
            if (player) {
                player.stopVideo();
            }
        }
          function stopVideo() {
            if (player) {
                player.stopVideo();
            }
        }

        function removeFromPlaylist(index) {
            if (index >= 0 && index < playlistItems.length) {
                playlistItems.splice(index, 1);
                localStorage.setItem("playlist", JSON.stringify(playlistItems));
                displayPlaylist();
            }
        }
       function backupPlaylist() {
            var backupCode = btoa(JSON.stringify(playlistItems));
            document.getElementById("backupInput").value = backupCode;
        }

        function restorePlaylist() {
            var backupCode = document.getElementById("backupInput").value;
            var restoredPlaylist = atob(backupCode);
            playlistItems = JSON.parse(restoredPlaylist);
            localStorage.setItem("playlist", JSON.stringify(playlistItems));
            displayPlaylist();
        }
  
   
       function toggleDropdown(index) {
            var dropdowns = document.getElementsByClassName("more-dropdown");
            for (var i = 0; i < dropdowns.length; i++) {
                if (i === index) {
                    dropdowns[i].style.display = dropdowns[i].style.display === "none" ? "block" : "none";
                } else {
                    dropdowns[i].style.display = "none";
                }
            }
        }
         function clearSearchResults() {
            var results = document.getElementById("results");
            results.innerHTML = "";
            document.getElementById("searchInput").value = "";
        }
      
        // Initialize Hammer.js on the controls section
var controlsElement = document.getElementById('controls');
var controlsHammer = new Hammer(controlsElement);

// Detect swipe gestures
controlsHammer.on('swipeleft', function() {
  playNextTrack();
});

controlsHammer.on('swiperight', function() {
  playPreviousTrack();
});

// Function to play the next track
function playNextTrack() {
  currentVideoIndex++;
  if (currentVideoIndex >= playlistItems.length) {
    currentVideoIndex = 0;
  }
  playVideo(playlistItems[currentVideoIndex].videoId);
}

// Function to play the previous track
function playPreviousTrack() {
  currentVideoIndex--;
  if (currentVideoIndex < 0) {
    currentVideoIndex = playlistItems.length - 1;
  }
  playVideo(playlistItems[currentVideoIndex].videoId);
}

// Initialize Hammer.js on the controls section
var controlsElement = document.getElementById('controls');
var controlsHammer = new Hammer(controlsElement);

// Detect swipe up and swipe down gestures
controlsHammer.get('swipe').set({ direction: Hammer.DIRECTION_VERTICAL });
controlsHammer.on('swipeup swipedown', function(event) {
  event.preventDefault();
});

controlsHammer.on('swipeup', function() {
  showMiniPlayer();
});

controlsHammer.on('swipedown', function() {
  hideMiniPlayer();
});

// Function to show the mini player
// Function to show the mini player
function showMiniPlayer() {
  var miniPlayer = document.getElementById('mini-player');
  miniPlayer.style.transform = 'translateY(0)';
}


// Function to hide the mini player
function hideMiniPlayer() {
  var miniPlayer = document.getElementById('mini-player');
  miniPlayer.style.transform = 'translateY(100%)';
}


        function shuffleAndPlay() {
            var storedPlaylist = localStorage.getItem("playlist");
            if (!storedPlaylist) {
                alert("Playlist is empty. Add videos to the playlist first.");
                return;
            }

            playlistItems = JSON.parse(storedPlaylist);
            shuffleArray(playlistItems);
            currentVideoIndex = 0;


            if (player) {
                playVideo(playlistItems[currentVideoIndex].videoId);
            }
        }

        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
        }
        function addPlaylistByLink() {
            var playlistLink = document.getElementById("playlistLinkInput").value;
            var playlistId = extractPlaylistId(playlistLink);

            if (playlistId) {
                fetchPlaylistItems(playlistId);
            } else {
                alert("Invalid YouTube playlist link. Please enter a valid link.");
            }
        }

        function extractPlaylistId(playlistLink) {
            var regex = /[&?](?:list|p)=([a-zA-Z0-9_-]{34})/;
            var match = playlistLink.match(regex);

            if (match && match.length > 1) {
                return match[1];
            }

            return null;
        }

        function fetchPlaylistItems(playlistId) {
            var apiKey = apiKeys[currentApiKeyIndex];
            var url =
                "https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=100&playlistId=" +
                playlistId +
                "&key=" +
                apiKey;

            $.ajax({
                url: url,
                success: function (response) {
                    processPlaylistItems(response.items);
                },
                error: function (xhr) {
                    console.log(xhr);
                },
            });
        }

        function processPlaylistItems(items) {
            var playlist = localStorage.getItem("playlist");
            playlistItems = playlist ? JSON.parse(playlist) : [];

            for (var i = 0; i < items.length; i++) {
                var video = items[i].snippet;
                var videoId = video.resourceId.videoId;
                var videoTitle = video.title;

                playlistItems.push({
                    videoId: videoId,
                    videoTitle: videoTitle,
                });
            }

            localStorage.setItem("playlist", JSON.stringify(playlistItems));

            displayPlaylist();
        }

        displayPlaylist();
       
       function handleVisibilityChange() {
           if (document.visibilityState === 'visible') {
               if (isPlaying) {
                   player.playVideo();
               }
           } else {
               if (isPlaying) {
                   player.pauseVideo();
               }
           }
       }

       // Add event listener for visibility change
       document.addEventListener('visibilitychange', handleVisibilityChange);

       // Load the YouTube IFrame Player API asynchronously
       var tag = document.createElement('script');
       tag.src = 'https://www.youtube.com/iframe_api';
       var firstScriptTag = document.getElementsByTagName('script')[0];
       firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  
   var apiKey = 'AIzaSyCm3Ezp_uPaNeMjOTXMYVM0FmQ015auYeA';
       var playlistIds = {
           rock: 'RDCLAK5uy_k1272v-yXtLJm7gmMiAxjOl-vh5aEC11A',
           pop: 'RDCLAK5uy_mvsCHKeFgZxCoFoMA2CClIVPvhFaJCfV8',
           electronic: 'RDCLAK5uy_lL718gGQZgQf4jkKYjVbOXHABQCFAYuj0',
           hiphop: 'RDCLAK5uy_m6_xW9k1AulRRrn2tpl9gU_Lp3v110LpA'
       };

       $(document).ready(function() {
           loadPlaylist('rock', 'playlist-rock');
           loadPlaylist('pop', 'playlist-pop');
           loadPlaylist('electronic', 'playlist-electronic');
           loadPlaylist('hiphop', 'playlist-hiphop');
       });

     function loadPlaylist(playlistType, containerId) {
 var playlistContainer = document.getElementById(containerId);
 var playlistThumbnail = playlistContainer.querySelector('.playlist-thumbnail');
 var songListContainer = playlistContainer.querySelector('.song-list-container');
 var songList = playlistContainer.querySelector('.song-list');

 var playlistUrl =
   'https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=100&playlistId=' +
   playlistIds[playlistType] +
   '&key=' +
   apiKey;

 $.getJSON(playlistUrl, function (response) {
   var items = response.items;
   for (var i = 0; i < items.length; i++) {
     var video = items[i].snippet;
     var videoId = video.resourceId.videoId;
     var videoTitle = video.title;
     var videoThumbnail = video.thumbnails.default.url;

     var listItem = document.createElement('li');
     listItem.innerHTML = `
           <img class="song-thumbnail" src="${videoThumbnail}" alt="Video Thumbnail">
           <div class="song-title">${videoTitle}</div>
       `;

     listItem.addEventListener(
       'click',
       (function (id) {
         return function () {
           playVideo(id);
         };
       })(videoId)
     );

     songList.appendChild(listItem);
   }

   playlistThumbnail.src =
     'https://img.youtube.com/vi/' +
     items[0].snippet.resourceId.videoId +
     '/mqdefault.jpg';
 });

 playlistThumbnail.addEventListener('click', function () {
   songListContainer.style.display =
     songListContainer.style.display === 'block' ? 'none' : 'block';
 });

 var shuffleButton = document.createElement('button');
//  shuffleButton.textContent = 'Shuffle and Play';
//  shuffleButton.addEventListener('click', function () {
//    shuffleAndPlay2(playlistType);
//  });

//  playlistContainer.appendChild(shuffleButton);
}

var shuffledPlaylist = []; // Define an array to store the shuffled playlist
var currentVideoIndex = 0; // Initialize the index of the currently playing video

function shuffleAndPlay2(playlistType) {
 var playlistUrl =
   'https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=10&playlistId=' +
   playlistIds[playlistType] +
   '&key=' +
   apiKey;

 $.getJSON(playlistUrl, function (response) {
   var items = response.items;
   shuffledPlaylist = shuffleArray(items); // Shuffle the playlist
   var videoIds = shuffledPlaylist.map(function (item) {
     return item.snippet.resourceId.videoId;
   });

   if (player) {
     player.loadPlaylist(videoIds); // Load the shuffled playlist
     player.setLoop(true);
     player.playVideo();

     // Update the controls with the first video in the shuffled playlist
     var firstVideoId = shuffledPlaylist[0].snippet.resourceId.videoId;
     var firstVideoTitle = shuffledPlaylist[0].snippet.title;

     updateMiniPlayer(firstVideoId, firstVideoTitle);
   }
 });
}

// Listen for the "onStateChange" event to track when a video ends
if (player) {
 player.addEventListener('onStateChange', function (event) {
   if (event.data === YT.PlayerState.ENDED) {
     // Video ended, play the next video in the shuffled playlist
     currentVideoIndex = (currentVideoIndex + 1) % shuffledPlaylist.length;
     var nextVideoId = shuffledPlaylist[currentVideoIndex].snippet.resourceId.videoId;
     var nextVideoTitle = shuffledPlaylist[currentVideoIndex].snippet.title;

     player.loadVideoById(nextVideoId);
     updateMiniPlayer(nextVideoId, nextVideoTitle);
   }
 });
}





function shuffleArray(array) {
 var currentIndex = array.length,
   temporaryValue,
   randomIndex;

 while (0 !== currentIndex) {
   randomIndex = Math.floor(Math.random() * currentIndex);
   currentIndex -= 1;

   temporaryValue = array[currentIndex];
   array[currentIndex] = array[randomIndex];
   array[randomIndex] = temporaryValue;
 }

 return array;
}




        function playVideo(videoId) {
 if (player) {
   player.loadVideoById(videoId);
   player.playVideo();

   // Fetch video title using YouTube API
   var url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${apiKey}`;

   $.ajax({
     url: url,
     success: function(response) {
       var videoTitle = response.items[0].snippet.title;
       updateMiniPlayer(videoId, videoTitle);
     },
     error: function(xhr) {
       console.log(xhr);
     }
   });
 }
}
      function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.PLAYING) {
        isPlaying = true;
        startProgressInterval();
        
        // Get the video title and videoId
        var videoTitle = player.getVideoData().title;
        var videoId = player.getVideoData().video_id;
        
        // Update the video title and thumbnail in your controls
        updateVideoTitleAndThumbnail(videoTitle, videoId);
    } else {
        isPlaying = false;
        stopProgressInterval();
    }

    if (event.data === YT.PlayerState.ENDED) {
        handleVideoEnd();
    }
}

      function updateVideoTitleAndThumbnail(title, videoId) {
    // Find the video title and thumbnail elements in your controls
    var videoTitleElement = document.querySelector('.video-title');
    var videoThumbnailElement = document.querySelector('.video-thumbnail');

    // Split the title into words
    var words = title.split(' ');

    // If the title has more than 6 words, truncate it
    if (words.length > 6) {
        title = words.slice(0, 6).join(' ') + '...';
    }

    // Set the new video title and thumbnail
    videoTitleElement.textContent = title;
    videoThumbnailElement.src = "https://img.youtube.com/vi/" + videoId + "/default.jpg";
}

function updateMiniPlayer(videoId, videoTitle) {
 var miniThumbnail = document.querySelector('.video-thumbnail');
 var miniTitle = document.querySelector('.video-title');

 // Split the video title into words and limit to 5 words
 var words = videoTitle.split(' ').slice(0, 5);
 var truncatedTitle = words.join(' ');

 miniThumbnail.src = `https://img.youtube.com/vi/${videoId}/default.jpg`;
 miniTitle.textContent = truncatedTitle;
}


      

  
  
  
   </script>

 <script>
     function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.PLAYING) {
        isPlaying = true;
        startProgressInterval();
         // Get the video title and videoId
         var videoTitle = player.getVideoData().title;
        var videoId = player.getVideoData().video_id;
        
        // Update the video title and thumbnail in your controls
        updateVideoTitleAndThumbnail(videoTitle, videoId);
    } else {
        isPlaying = false;
        stopProgressInterval();
    }

    if (event.data === YT.PlayerState.ENDED) {
        handleVideoEnd();
    }
    updateVideoTitle2();
    updatePlayPauseButton();
}
function updateVideoTitle2() {
  var videoTitle = player.getVideoData().title;
  var videoTitleElement = document.querySelector('.video-title2');
  videoTitleElement.textContent = videoTitle;
}
function updateVideoTitleAndThumbnail(title, videoId) {
    // Find the video title and thumbnail elements in your controls
    var videoTitleElement = document.querySelector('.video-title');
    var videoThumbnailElement = document.querySelector('.video-thumbnail');

    // Split the title into words
    var words = title.split(' ');

    // If the title has more than 6 words, truncate it
    if (words.length > 6) {
        title = words.slice(0, 6).join(' ') + '...';
    }

    // Set the new video title and thumbnail
    videoTitleElement.textContent = title;
    videoThumbnailElement.src = "https://img.youtube.com/vi/" + videoId + "/default.jpg";
}

       // Load the YouTube IFrame Player API asynchronously
       // Load the YouTube IFrame Player API asynchronously
       var tag = document.createElement('script');
       tag.src = 'https://www.youtube.com/iframe_api';
       var firstScriptTag = document.getElementsByTagName('script')[0];
       firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
   </script>
</body>
</html>
