<!DOCTYPE html>
<html>
<head>
    <title>Music Search and Play</title>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        #player {
            width: 392px;
            height: 221px;
        }

        .more-button {
            float: right;
        }

        .more-dropdown {
            display: none;
            position: absolute;
            right: 0;
            background-color: #f9f9f9;
            padding: 5px;
        }

        .more-dropdown a {
            display: block;
            margin-bottom: 5px;
            text-decoration: none;
            color: #333;
        }

        .playlist-item {
            margin: 5px 0;
            padding: 10px;
            background-color: #f2f2f2;
        }

        .playlist-item strong {
            font-weight: bold;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <h1>Music Search and Play</h1>
    <input type="text" id="searchInput" placeholder="Enter song or artist">
    <button onclick="search()">Search</button>

    <div id="results"></div>

    <h2>Playlist</h2>
    <div id="playlist"></div>
    <button onclick="clearPlaylist()">Clear Playlist</button>
    <button onclick="shuffleAndPlay()">Shuffle and Play</button>

    <div id="player"></div>

    <script>
        var player;
        var playlistItems;
        var currentVideoIndex = 0;

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '221',
                width: '392',
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            // Player is ready to receive commands
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.ENDED) {
                // Video has ended, play the next video
                currentVideoIndex++;
                if (currentVideoIndex < playlistItems.length) {
                    playVideo(playlistItems[currentVideoIndex].videoId);
                } else {
                    currentVideoIndex = 0;
                    player.stopVideo();
                }
            }
        }

        function search() {
            var query = document.getElementById("searchInput").value;
            var url = "https://www.googleapis.com/youtube/v3/search?part=snippet&q=" + query + "&type=video&key=AIzaSyCm3Ezp_uPaNeMjOTXMYVM0FmQ015auYeA";

            $.ajax({
                url: url,
                success: function (response) {
                    displayResults(response);
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        }

        function displayResults(response) {
            var results = document.getElementById("results");
            results.innerHTML = "";

            for (var i = 0; i < response.items.length; i++) {
                var video = response.items[i];
                var videoId = video.id.videoId;
                var videoTitle = video.snippet.title;

                var div = document.createElement("div");
                var title = document.createElement("p");
                var player = document.createElement("iframe");
                var addToPlaylistButton = document.createElement("button");
                var playVideoButton = document.createElement("button");

                title.textContent = videoTitle;

                player.src = "https://www.youtube.com/embed/" + videoId;
                player.width = "560";
                player.height = "315";

                addToPlaylistButton.textContent = "Add to Playlist";
                addToPlaylistButton.addEventListener("click", function(id, title) {
                    return function() {
                        addToPlaylist(id, title);
                    };
                }(videoId, videoTitle));

                playVideoButton.textContent = "Play Video";
                playVideoButton.addEventListener("click", function(id) {
                    return function() {
                        playVideo(id);
                    };
                }(videoId));

                div.appendChild(title);
                div.appendChild(player);
                div.appendChild(addToPlaylistButton);
                div.appendChild(playVideoButton);
                results.appendChild(div);
            }
        }

        function addToPlaylist(videoId, videoTitle) {
            var playlist = localStorage.getItem("playlist");
            playlistItems = playlist ? JSON.parse(playlist) : [];

            playlistItems.push({
                videoId: videoId,
                videoTitle: videoTitle
            });

            localStorage.setItem("playlist", JSON.stringify(playlistItems));

            displayPlaylist();
        }

        function displayPlaylist() {
            var playlistDiv = document.getElementById("playlist");
            playlistDiv.innerHTML = "";

            var storedPlaylist = localStorage.getItem("playlist");
            if (storedPlaylist) {
                playlistItems = JSON.parse(storedPlaylist);
                for (var i = 0; i < playlistItems.length; i++) {
                    var playlistItem = document.createElement("div");
                    playlistItem.className = "playlist-item";

                    var listItem = document.createElement("p");
                    var moreButton = document.createElement("button");
                    var moreDropdown = document.createElement("div");
                    var playOption = document.createElement("a");
                    var removeOption = document.createElement("a");

                    listItem.innerHTML = "<strong>" + (i + 1) + ". </strong>" + playlistItems[i].videoTitle;

                    moreButton.textContent = "More â–¼";
                    moreButton.className = "more-button";
                    moreButton.addEventListener("click", function(index) {
                        return function() {
                            toggleDropdown(index);
                        };
                    }(i));

                    moreDropdown.className = "more-dropdown";

                    playOption.textContent = "Play";
                    playOption.href = "#";
                    playOption.addEventListener("click", function(index) {
                        return function() {
                            currentVideoIndex = index;
                            playVideo(playlistItems[currentVideoIndex].videoId);
                            toggleDropdown(index);
                        };
                    }(i));

                    removeOption.textContent = "Remove";
                    removeOption.href = "#";
                    removeOption.addEventListener("click", function(index) {
                        return function() {
                            removeFromPlaylist(index);
                            toggleDropdown(index);
                        };
                    }(i));

                    moreDropdown.appendChild(playOption);
                    moreDropdown.appendChild(removeOption);

                    listItem.appendChild(moreButton);
                    listItem.appendChild(moreDropdown);
                    playlistItem.appendChild(listItem);
                    playlistDiv.appendChild(playlistItem);
                }
            } else {
                playlistDiv.innerHTML = "Playlist is empty";
            }
        }

        function playVideo(videoId) {
            if (player) {
                player.loadVideoById(videoId);
                player.playVideo();
            }
        }

     


        function clearPlaylist() {
            localStorage.removeItem("playlist");
            playlistItems = [];
            displayPlaylist();
            currentVideoIndex = 0;
            if (player) {
                player.stopVideo();
            }
        }

        function removeFromPlaylist(index) {
            if (index >= 0 && index < playlistItems.length) {
                playlistItems.splice(index, 1);
                localStorage.setItem("playlist", JSON.stringify(playlistItems));
                displayPlaylist();
            }
        }

        function toggleDropdown(index) {
            var dropdowns = document.getElementsByClassName("more-dropdown");
            for (var i = 0; i < dropdowns.length; i++) {
                if (i === index) {
                    dropdowns[i].style.display = dropdowns[i].style.display === "none" ? "block" : "none";
                } else {
                    dropdowns[i].style.display = "none";
                }
            }
        }

       
        

        function shuffleAndPlay() {
            var storedPlaylist = localStorage.getItem("playlist");
            if (!storedPlaylist) {
                alert("Playlist is empty. Add videos to the playlist first.");
                return;
            }

            playlistItems = JSON.parse(storedPlaylist);
            shuffleArray(playlistItems);
            currentVideoIndex = 0;

 
            if (player) {
                playVideo(playlistItems[currentVideoIndex].videoId);
            }
        }

        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
        }

        displayPlaylist();
    </script>

    <script>
        // Load the YouTube IFrame Player API asynchronously
        // Load the YouTube IFrame Player API asynchronously
        var tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>
</body>
</html>
